# Ralph Progress Log
Started: Thu Jan 22 14:33:52 CST 2026
Updated: Fri Jan 24 2026 - New PRD: Calendar Actual Timeline Fix
---

## Codebase Patterns
- Evidence data is fetched in `apps/mobile/src/lib/supabase/services/evidence-data.ts`
- Actual event derivation happens in `apps/mobile/src/lib/calendar/actual-display-events.ts`
- Screen time derivation is in `apps/mobile/src/lib/calendar/derive-screen-time-actual-events.ts`
- Calendar orchestration is in `apps/mobile/src/app/comprehensive-calendar.tsx`
- Rendering with absolute positioning is in `apps/mobile/src/components/templates/ComprehensiveCalendarTemplate.tsx`
- Known duplicate key issue at ComprehensiveCalendarTemplate.tsx lines 552-559
- Android native module for insights: `apps/mobile/modules/android-insights/android/src/main/java/expo/modules/androidinsights/AndroidInsightsModule.kt`
- Use `Log.d(TAG, ...)` for production logging in Kotlin (logcat tag: "AndroidInsights")
- TypeScript wrapper in `apps/mobile/modules/android-insights/src/index.ts`
- Library wrapper with safe functions in `apps/mobile/src/lib/android-insights/index.ts`
- Dev screen for Android insights at `apps/mobile/src/app/dev/android-insights.tsx`
- Pre-existing TypeScript errors in codebase - don't expect clean typecheck
- **Screen time sync**: `apps/mobile/src/lib/supabase/services/screen-time-sync.ts` - syncs iOS and Android data to Supabase
- **Insights sync hook**: `apps/mobile/src/lib/supabase/hooks/use-insights-sync.ts` - orchestrates sync on app active
- When comparing iOS vs Android sync, always check if all data fields are being synced (sessions, hourly, daily)
- **Derived Event ID Format**: Use `derived:{type}:{startMinutes}:{endMinutes}:{source}` for deterministic unique IDs
- **Screen Time Event ID Format**: Use `st:{type}:{startMinutes}:{endMinutes}:{source}` for screen time derived events
- **Overlap Resolution**: Use `buildNonOverlappingTimeline()` from `actual-timeline-builder.ts` to resolve overlaps by splitting events
- **Event Priority Order**: UserEdited(1) > SupabaseActual(2) > DerivedEvidence(3) > ScreenTime(4) > Unknown(5)
- **Duplicate Cleanup**: Use `cleanupDuplicateDerivedEvents()` from `calendar-events.ts` to remove duplicates while preserving oldest
- **Re-derivation Prevention**: `buildActualDisplayEvents` tracks saved derived events by source_id and time+kind to skip re-derivation
- **Evidence Priority Order**: UserPlanned(1) > Location(2) > ScreenTime(3) > Pattern(4) > Health(5) - defined in `EvidenceSourcePriority` enum in `evidence-fusion.ts`
- **Contextual Screen Time**: Use `isContextualScreenTime()` to check if screen time is expected for an activity (e.g., calculator at work) - contextual usage doesn't override location

## Critical Issue - Android Physical Device
- **Problem**: Evidence data (location, screen time) not pulling on physical Android devices
- **Works**: Android simulator
- **Fails**: Physical Android device via Play Console internal testing (production build)
- **Permissions**: All granted (Usage Access, Location)
- **Symptom**: Nothing being pulled despite permissions granted
- **Priority**: HIGHEST - US-001 and US-002 must be completed first

---

## 2026-01-24 - US-001: CRITICAL: Debug Android Production Evidence Data Pull Failure
- **What was implemented:**
  - Added comprehensive production-safe logging to Android Usage Stats API calls
  - Created `getUsageStatsDiagnostics()` function in Kotlin that returns:
    - Device info (manufacturer, model, SDK version)
    - AppOps permission status with mode string
    - Usage stats counts from multiple intervals (daily, best, weekly)
    - Usage events count (foreground/background)
    - Top app with foreground time
    - Error collection
  - Exposed diagnostics through TypeScript layer (`getUsageStatsDiagnosticsAsync`)
  - Added diagnostics UI to dev/android-insights screen
  - Enhanced Android location diagnostics with detailed logging

- **Files changed:**
  - `apps/mobile/modules/android-insights/android/src/main/java/expo/modules/androidinsights/AndroidInsightsModule.kt` - Added logging, diagnostics function
  - `apps/mobile/modules/android-insights/src/index.ts` - Added TypeScript types and exports
  - `apps/mobile/src/lib/android-insights/index.ts` - Added safe wrapper function
  - `apps/mobile/src/app/dev/android-insights.tsx` - Added diagnostics UI
  - `apps/mobile/src/lib/android-location/index.ts` - Added logging to location startup and diagnostics

- **Learnings for future iterations:**
  - Use `android.util.Log` with a constant TAG for production-visible logging in Kotlin
  - Logcat tag "AndroidInsights" can be filtered on device: `adb logcat -s AndroidInsights`
  - AppOps mode values: MODE_ALLOWED=0, MODE_IGNORED=1, MODE_ERRORED=2, MODE_DEFAULT=3
  - `queryUsageStats` can return empty list even with permission if:
    1. Permission was just granted (no data collected yet)
    2. No app usage in the time range
    3. System-level issue with usage stats service
  - The codebase has many pre-existing TypeScript errors - don't expect clean typecheck

- **Next steps:**
  - Deploy to Play Console internal testing
  - Run diagnostics on physical device
  - Check logcat output for root cause
  - Implement fix based on findings (US-002)

---

## 2026-01-24 - US-002: Fix Android Production Build Evidence Collection
- **What was implemented:**
  - Added Android session syncing to `screen-time-sync.ts` - previously sessions were not being synced to Supabase
  - Added hourly data syncing for Android (matches iOS behavior)
  - Added production-safe logging throughout the sync pipeline for debugging
  - Handle null/empty usage summary gracefully with status tracking
  - Updated dev screen to show session counts and recent sessions

- **Files changed:**
  - `apps/mobile/src/lib/supabase/services/screen-time-sync.ts` - Added `mapAndroidUsageSessions()`, hourly sync, session sync, logging
  - `apps/mobile/src/lib/supabase/hooks/use-insights-sync.ts` - Added production logging, handle null summary case
  - `apps/mobile/src/app/dev/android-insights.tsx` - Show session counts and recent sessions in usage summary UI

- **Root Cause Analysis:**
  - Android sessions were not being synced to Supabase - `syncAndroidUsageSummary` was calling `await replaceAppSessions(dailyId, [])` which always cleared sessions
  - The native Kotlin module WAS producing sessions in `buildUsageHourlyBucketsSeconds()` via `queryEvents()`
  - The TypeScript `UsageSummary` type already included `sessions?: Array<{...}>`
  - The sync code just never used them

- **Learnings for future iterations:**
  - Android screen time sync was incomplete compared to iOS - always compare platform implementations
  - Silent failures in production are hard to debug - add console.log even in production for critical paths
  - The `screen_time_app_sessions` table is critical for actual timeline derivation
  - When debugging data flow issues, trace the entire pipeline from native → TypeScript → Supabase

---

## 2026-01-24 - US-003: Generate Unique Deterministic Event IDs
- **What was implemented:**
  - Created `generateDerivedId()` helper function in `actual-display-events.ts` for consistent ID format
  - Created `generateScreenTimeId()` helper function in `derive-screen-time-actual-events.ts`
  - Updated all derived event ID generation to use format: `{prefix}{type}:{startMinutes}:{endMinutes}:{source}`
  - Added uniqueness validation in `ComprehensiveCalendarTemplate.tsx` using useMemo
  - Deduplicates events before rendering with warning log when duplicates found
  - Fixes React duplicate key warnings

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Added helper, updated 9 ID generation points
  - `apps/mobile/src/lib/calendar/derive-screen-time-actual-events.ts` - Added helper, updated 5 ID generation points
  - `apps/mobile/src/components/templates/ComprehensiveCalendarTemplate.tsx` - Added deduplication with warning log

- **Learnings for future iterations:**
  - Event IDs should include both start AND end minutes to prevent collisions
  - Including a source identifier (app name, event ID, etc.) adds extra uniqueness
  - Pre-render validation with console.warn helps catch issues early
  - The ID format `{type}:{startMinutes}:{endMinutes}:{source}` is deterministic and debuggable
  - Codebase has 42+ pre-existing TypeScript errors - changes don't need to clear all errors, just not introduce new ones

---

## 2026-01-24 - US-004: Create ActualTimelineBuilder with Overlap Split Algorithm
- **What was implemented:**
  - Created `ActualTimelineBuilder` class in `apps/mobile/src/lib/calendar/actual-timeline-builder.ts`:
    - `EventPriority` enum with 5 priority levels
    - `getEventPriority()` function to determine event priority from metadata
    - `addEvent()` method that handles overlap by splitting events
    - `addEvents()` method for batch processing (sorted by priority)
    - `build()` method to return final non-overlapping timeline
    - `validate()` method to check for any remaining overlaps
    - `buildNonOverlappingTimeline()` convenience function
  - Priority order implemented: UserEdited(1) > SupabaseActual(2) > DerivedEvidence(3) > ScreenTime(4) > Unknown(5)
  - Split algorithm: when events overlap, lower-priority events are split around higher-priority events
  - Exported from `apps/mobile/src/lib/calendar/index.ts`
  - Integrated into `actual-display-events.ts`, replacing `removeOverlappingEvents` call

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-timeline-builder.ts` - New file with ActualTimelineBuilder class
  - `apps/mobile/src/lib/calendar/index.ts` - Added export for actual-timeline-builder
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Import and use buildNonOverlappingTimeline

- **Learnings for future iterations:**
  - The split approach preserves more event data than simply removing overlapping events
  - Priority detection uses metadata fields: source, kind, and ID prefixes
  - Events with `source: 'user'` or `source: 'actual_adjust'` are highest priority
  - Events with ID prefixes like `derived_actual:`, `derived_evidence:`, or `st:` indicate derived events
  - The `minDurationMinutes` parameter prevents creating tiny split segments

---

## 2026-01-24 - US-005: Add Unit Test for Overlap Elimination
- **What was implemented:**
  - Created comprehensive test file `actual-timeline-builder.test.ts` with 32 tests
  - Tests for `getEventPriority()` function covering all 5 priority levels
  - Tests for overlap resolution: two events overlapping get split into non-overlapping result
  - Tests for priority preservation: higher priority events remain intact, lower get split
  - Edge case tests: exact same time, partial overlap at start/end, contained event, adjacent events
  - Tests for invalid inputs: zero duration, negative duration events are skipped
  - Tests for `minDurationMinutes` filtering of tiny segments
  - Tests for `validate()`, `clear()`, and `eventCount` methods

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-timeline-builder.test.ts` - New test file with 32 tests

- **Learnings for future iterations:**
  - Use `createTestEvent()` helper for creating minimal test events with required fields
  - Use `hasOverlaps()` helper to validate no two events overlap in result
  - Test priority order: UserEdited(1) > SupabaseActual(2) > DerivedEvidence(3) > ScreenTime(4) > Unknown(5)
  - Pre-existing TypeScript errors in codebase - verify new files don't add errors, not that all errors are fixed
  - Jest tests use `@/stores` path alias which works with project's jest config

---

## 2026-01-24 - US-006: Integrate ActualTimelineBuilder into Display Pipeline
- **What was implemented:**
  - Verified that `buildNonOverlappingTimeline` from `ActualTimelineBuilder` is already integrated in `buildActualDisplayEvents()` at line 446
  - Removed the unused `removeOverlappingEvents` function (61 lines of dead code) that was no longer being called
  - The integration was completed in US-004, this story cleaned up the remaining dead code
  - Verified ComprehensiveCalendarTemplate.tsx has ID-based deduplication for React key uniqueness (separate concern from time overlap)

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Removed unused `removeOverlappingEvents` function

- **Learnings for future iterations:**
  - The overlap handling with ActualTimelineBuilder was integrated during US-004 along with creating the class
  - ComprehensiveCalendarTemplate.tsx deduplicates by event ID (for React keys), while ActualTimelineBuilder deduplicates by time range (for visual overlap)
  - When cleaning up old code, verify nothing else uses it with grep before removing
  - Pre-existing TypeScript errors (42+) are unrelated to changes - only check for NEW errors introduced

---

## 2026-01-24 - US-007: Fix Actual Data Persistence - Prevent Prior Day Erasure
- **What was implemented:**
  - Added comprehensive production logging to trace actual event lifecycle:
    - `fetchActualCalendarEventsForDay` logs fetch with event counts and derived event counts
    - `syncDerivedActualEvents` logs sync operations with skip/insert counts
    - `comprehensive-calendar.tsx` logs load and cleanup operations
  - Created `hasSyncedDerivedEventsForDay()` function to check if a day already has synced derived events
  - Created `cleanupDuplicateDerivedEvents()` function that:
    - Groups events by time range and kind
    - Keeps the oldest event in each group (determined by `created_at`)
    - Removes duplicates deterministically rather than arbitrarily
  - Enhanced `buildActualDisplayEvents` to prevent re-derivation:
    - Tracks saved derived events by both source_id and time+kind key
    - Skips re-derivation when matching saved events already exist
  - Updated `comprehensive-calendar.tsx` cleanup logic to use the new deterministic cleanup function

- **Files changed:**
  - `apps/mobile/src/lib/supabase/services/calendar-events.ts` - Added logging, hasSyncedDerivedEventsForDay(), cleanupDuplicateDerivedEvents(), enhanced syncDerivedActualEvents()
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Enhanced duplicate detection with source_id tracking
  - `apps/mobile/src/app/comprehensive-calendar.tsx` - Updated cleanup logic to use cleanupDuplicateDerivedEvents()

- **Learnings for future iterations:**
  - Prior day erasure was caused by non-deterministic cleanup: the old logic would remove overlapping derived events arbitrarily
  - The fix ensures oldest events are preserved by using `created_at` ordering
  - Double-tracking by both source_id AND time+kind provides robust duplicate detection
  - Production logging (using console.log) helps debug sync issues on physical devices
  - When cleaning up duplicates, always prefer keeping the oldest record for data consistency

---

## 2026-01-24 - US-008: Implement Evidence Priority Resolution
- **What was implemented:**
  - Added `EvidenceSourcePriority` enum with explicit priority ordering:
    1. UserPlanned (highest) - user's intended activity
    2. Location - physical presence as strongest evidence
    3. ScreenTime - intentionality check
    4. Pattern - historical behavior
    5. Health (lowest) - workout/sleep data
  - Added `priority` field to `EvidenceFusionSource` interface
  - Added `isContextual` flag to detect expected screen time usage (e.g., calculator at work)
  - Added `isContextualScreenTime()` function to check if screen time is expected for the planned activity:
    - Work/digital/meeting activities: productive apps (email, slack, docs, etc.) are contextual
    - Health activities: fitness/music apps are contextual
  - Added `primarySource` and `primarySourcePriority` fields to `EvidenceFusionResult`
  - Updated `SOURCE_WEIGHTS` to reflect new priority order
  - Updated `resolveConflict()` to use priority-based resolution:
    - Location wins when it contradicts the plan
    - Screen time only overrides when significant (>=20 min) AND non-contextual
    - Patterns require high confidence (>=0.8) to win
  - Added confidence boost when location confirms the plan
  - Exported `EvidenceSourcePriority` from calendar index.ts

- **Files changed:**
  - `apps/mobile/src/lib/calendar/evidence-fusion.ts` - Added priority system, contextual screen time check, enhanced fusion logic
  - `apps/mobile/src/lib/calendar/index.ts` - Added export for evidence-fusion

- **Learnings for future iterations:**
  - Evidence priority determines which source is most trustworthy for actual timeline
  - Contextual screen time (work apps during work) shouldn't override location evidence
  - The `primarySource` field helps UI components show which evidence determined the event
  - Pre-existing TypeScript errors (40+) in codebase are unrelated to these changes

---

## 2026-01-24 - US-009: Cross-Reference Planned Events with Evidence - Shifting
- **What was implemented:**
  - Created `detectLateArrival()` function in `actual-display-events.ts` that:
    - Checks verification timing data for late arrival
    - Cross-references location blocks to find when user actually arrived
    - Compares planned location with actual location evidence timestamps
    - Returns `LateArrivalInfo` with lateMinutes, actualStartMinutes, and evidenceSource
  - Modified `buildPlannedActualEvent()` to:
    - Call `detectLateArrival()` at the start of event processing
    - Shift actual start time when late arrival detected (actualStartMinutes vs plannedStartMinutes)
    - Pass late arrival info to description builder
  - Updated `buildActualDescription()` to add "Arrived X min late" annotation
  - Added `lateArrival` field to `evidence` metadata in CalendarEventMeta
  - Added `late_arrival` kind to CalendarEventMeta for UI differentiation
  - Set late arrival thresholds: min 5 min (to be considered late), max 60 min (before it's a different activity)

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Added detectLateArrival(), updated buildPlannedActualEvent() and buildActualDescription()
  - `apps/mobile/src/stores/events-store.ts` - Added `late_arrival` to kind union, added `lateArrival` to evidence interface

- **Learnings for future iterations:**
  - The verification engine already has a `timing.lateMinutes` field - check it first before doing custom location analysis
  - Late arrival detection should be bounded (5-60 min) to distinguish from "different activity entirely"
  - Planned events are never modified - only the actual timeline block gets the shifted start time
  - The `kind` field in meta is important for UI components to render appropriate indicators
  - Location blocks have `startMinutes` in minutes-from-midnight which matches planned event format

---

## 2026-01-24 - US-010: Cross-Reference Planned Events with Evidence - Different Activity
- **What was implemented:**
  - Created `DifferentActivityInfo` interface to track when user did something different than planned
  - Created `detectDifferentActivity()` function that:
    - First checks verification location evidence for mismatches (`!matchesExpected`)
    - Falls back to finding dominant location block during planned time
    - Uses `mapPlaceToCategory()` to infer activity category from location
    - Only flags as different if inferred category differs from planned category
    - Returns start/end times, place label/category, and evidence source
  - Modified `buildPlannedActualEvent()` to handle different activity:
    - Checks for different activity BEFORE late arrival detection
    - Creates evidence-based actual block with inferred title and category
    - Sets description as "Instead of: [planned title] • [place category]"
    - Uses `kind: 'different_activity'` for UI differentiation
    - Sets `source: 'evidence'` to indicate it came from location data
  - Updated CalendarEventMeta in events-store.ts:
    - Added `'different_activity'` to the kind union type
    - Added `differentActivity` field to evidence interface with full context:
      - plannedTitle, plannedCategory, actualLabel, actualCategory
      - evidenceSource, placeLabel, placeCategory

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Added DifferentActivityInfo interface, detectDifferentActivity() function, modified buildPlannedActualEvent()
  - `apps/mobile/src/stores/events-store.ts` - Added `different_activity` kind, added `differentActivity` evidence field

- **Learnings for future iterations:**
  - Different activity detection takes precedence over late arrival (mutually exclusive scenarios)
  - Use `mapPlaceToCategory()` to infer event category from location (meal, health, work, etc.)
  - The `intervalsOverlap()` helper is useful for finding location blocks during a time range
  - `DIFFERENT_ACTIVITY_MIN_DURATION` (10 min) prevents flagging brief location visits as "different activity"
  - Planned events remain visible in planned column - only actual column shows the reality
  - Evidence source metadata (`differentActivity.evidenceSource`) helps UI show where the info came from

---

## 2026-01-24 - US-011: Handle Screen Time Inside Sleep - Embed Short Usage
- **What was implemented:**
  - Added `MidSleepScreenTimeInfo` interface to track phone usage during sleep
  - Created `detectMidSleepScreenTime()` function that:
    - Identifies screen time sessions in the MIDDLE of sleep (30+ min after start, 30+ min before end)
    - Distinguishes from "staying up late" which is handled separately
    - Returns total minutes and top app used during mid-sleep phone checks
  - Created `buildSleepWithPhoneDescription()` function that formats embedded phone usage:
    - Format: "Sleep (phone: X min)" or "Sleep (phone: X min on AppName)"
    - Appends to existing description if one exists
  - Modified sleep event handling in `deriveActualEventsFromScreenTime()`:
    - First handles sleep start adjustment (staying up late scrolling)
    - Then checks for mid-sleep phone usage
    - Short usage (<=10 min): embeds in description, no separate block
    - Long usage (>10 min): left for US-012 to create separate blocks

- **Files changed:**
  - `apps/mobile/src/lib/calendar/derive-screen-time-actual-events.ts` - Added MidSleepScreenTimeInfo interface, detectMidSleepScreenTime(), buildSleepWithPhoneDescription(), modified sleep handling

- **Learnings for future iterations:**
  - Mid-sleep phone usage is different from "staying up late" - needs separate detection
  - Buffer zones (30 min from start/end) prevent false positives from alarm checks or falling asleep with phone
  - The distractionThresholdMinutes (default 10) serves as the cutoff for embedded vs separate blocks
  - Sleep descriptions can be chained: "Started late (...) (phone: X min)" for multiple annotations
  - App sessions provide precise timing needed for mid-sleep detection

---

## 2026-01-24 - US-012: Handle Screen Time Inside Sleep - Separate Long Usage
- **What was implemented:**
  - Created `SleepProcessingResult` interface for returning split sleep segments and screen time blocks
  - Created `buildMidSleepScreenTimeBlocks()` function that:
    - Creates separate screen time blocks for long phone usage (>10 min) during sleep
    - Merges adjacent sessions within 5 min gap to avoid creating too many blocks
    - Splits the sleep event around screen time blocks
    - Ensures minimum 15 min for sleep segments to be meaningful
  - Created `mergeMidSleepSessions()` to combine adjacent phone sessions
  - Created `generateSleepSegmentId()` for unique split segment IDs
  - Created `buildSplitSleepDescription()` that shows:
    - First segment: "Sleep (Xh total, interrupted Y min)"
    - Subsequent segments: "Sleep (continued)"
  - Added `duringSleep: true` flag to evidence metadata for mid-sleep screen time blocks
  - Modified main sleep handling to:
    - Return split sleep segments when long mid-sleep usage detected
    - Add screen time blocks and additional sleep segments to output

- **Files changed:**
  - `apps/mobile/src/lib/calendar/derive-screen-time-actual-events.ts` - Added SleepProcessingResult, buildMidSleepScreenTimeBlocks(), mergeMidSleepSessions(), generateSleepSegmentId(), buildSplitSleepDescription(), modified sleep handling
  - `apps/mobile/src/stores/events-store.ts` - Added `duringSleep` flag to evidence interface

- **Learnings for future iterations:**
  - Sleep splitting uses the ActualTimelineBuilder PATTERN but not the class directly (sleep has higher priority than screen time normally)
  - Adjacent screen time sessions should be merged to avoid fragmenting sleep into many small segments
  - Minimum segment duration (15 min) prevents creating meaningless tiny sleep blocks
  - The first sleep segment gets the summary annotation, subsequent ones say "continued"
  - Multiple sleep segments and screen time blocks are combined by adding extras to sleepLateBlocks array

---

## 2026-01-24 - US-013: Detect and Annotate Distractions
- **What was implemented:**
  - Added `DistractionInfo` interface to track distraction app usage during planned activities
  - Created `detectDistractionDuringActivity()` function that:
    - Filters screen time data to only distraction apps (using `DISTRACTION_APPS` list)
    - Calculates overlap with planned event time range
    - Returns total minutes, top app, and per-app breakdown
  - Short distractions (<=10 min): added annotation to event description
    - Format: "Work • Distracted 5 min on Instagram"
  - Long distractions (>10 min): creates separate "Distraction" block
    - Uses `buildDistractionBlock()` function
    - Sets `kind: 'distraction'` for UI differentiation
    - Includes detailed app usage in description (e.g., "Instagram (15 min), TikTok (8 min)")
  - Updated `buildPlannedActualEvent()` to return `PlannedActualResult` with both main event and distraction blocks
  - Added distraction evidence to `CalendarEventMeta` with app breakdown

- **Files changed:**
  - `apps/mobile/src/lib/calendar/actual-display-events.ts` - Added DistractionInfo interface, detectDistractionDuringActivity(), buildDistractionBlock(), modified buildPlannedActualEvent() and buildActualDescription()
  - `apps/mobile/src/stores/events-store.ts` - Added 'distraction' kind, added 'distraction' evidence interface

- **Learnings for future iterations:**
  - Distraction detection uses `DISTRACTION_APPS` from `verification-rules.ts` for consistent app classification
  - The `appMatchesList()` helper does case-insensitive partial matching
  - Short vs long distraction threshold is `DISTRACTION_THRESHOLD_MINUTES` (10 min)
  - `buildPlannedActualEvent()` now returns `{ mainEvent, distractionBlocks }` to support multiple outputs
  - Different activity detection takes precedence over distraction detection (mutually exclusive)
  - Distraction blocks are only created when user is at expected location (not "different activity")

---
